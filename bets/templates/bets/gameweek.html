{% load static %}
<link rel="stylesheet" type="text/css" href="{% static 'bets/normalize.css' %}"/>
<link rel="stylesheet" type="text/css" href="{% static 'bets/skeleton.css' %}"/>
{% load wagtailcore_tags %}
{% if gameweek %}
    <h1>Gameweek {{ gameweek.number }}</h1>
    <h2>Deadline: {{ gameweek.deadline }}</h2>
    <table><tr><th></th><th>Home</th><th>Draw</th><th>Away</th></tr>
    {% for game in gameweek.game_set.all %}
        <tr>
        <td>{{ game.hometeam }}</td>
        <td>{{ game.homenumerator }}/{{ game.homedenominator }}</td>
        <td>{{ game.drawnumerator }}/{{ game.drawdenominator }}</td>
        <td>{{ game.awaynumerator }}/{{ game.awaydenominator }}</td>
        <td>{{ game.awayteam }}</td>
        </tr>
    {% endfor %}
    </table>
    </br></br>
    {% if user.is_authenticated %}
        <h2>My bets</h2>
        {% for betpage in gameweek.betpage_set.all %}
            {% if user == betpage.owner %}
                {% for bets_list in betpage.bets %}
                    {% for bet in bets_list.value %}
                            <p>Stake: {% include_block bet.stake %}</p>
                            <ul>
                            {% for gameresult in bet.gameresults %}
                                <li>{% include_block gameresult.game %} - {% include_block gameresult.result %}</li>
                            {% endfor %}
                            </ul>
                    {% endfor %}
                {% endfor %}
            {% endif %}
        {% endfor %}
        {% if gameweek.deadline_passed %}
            <h2>Other bets</h2>
            {% for betpage in gameweek.betpage_set.all %}
                {% if user != betpage.owner %}
                    <h3>{{ user.username }}</h3>
                    {% for bets_list in betpage.bets %}
                        {% for bet in bets_list.value %}
                                <p>Stake: {% include_block bet.stake %}</p>
                                <ul>
                                {% for gameresult in bet.gameresults %}
                                    <li>{% include_block gameresult.game %} - {% include_block gameresult.result %}</li>
                                {% endfor %}
                                </ul>
                        {% endfor %}
                    {% endfor %}
                {% endif %}
            {% endfor %}
        {% endif %}
    {% endif %}
    </br></br>
    {% if gameweek.results_complete %}
        <h2>Results</h2>
        <table>
        <tr><th></th><th>This week</th><th>Provisional</th><th>Banked</th></tr>
        {% for k,v in gameweek.calculate_season_winnings.items %}
            <tr><td>{{ k }}</td><td>{{ v.Week }}</td><td>{{ v.Provisional }}</td><td>{{ v.Banked }}</td></tr>
        {% endfor %}
        </table>
    {% endif %}
{% else %}
    <p>No data available.</p>
{% endif %}
